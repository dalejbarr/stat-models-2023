<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Linear mixed-effects modeling with crossed random factors</title>
<meta name="author" content="Statistical Models"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="./reveal.js/dist/reveal.css"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/black.css" id="theme"/>

<link rel="stylesheet" href="./local.css"/>

<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = './reveal.js/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<meta name="description" content="Correlation and Regression">
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide" data-background="../img/titlescreen.png"><h1 class="title">Linear mixed-effects modeling with crossed random factors</h1><p class="subtitle"></p>
<h2 class="author">Statistical Models</h2><h2 class="date">Psychology, University of Glasgow</h2><p class="date">Created: 2022-11-03 Thu 08:54</p>
</section>

<section>
<section id="slide-orgbb3d6bb">
<h2 id="orgbb3d6bb">overview</h2>
<ul>
<li>generalizing to subjects and stimuli
<ul>
<li>dealing with "crossed" random factors</li>

</ul></li>

<li>random effects in complex designs</li>

<li>non-convergence and model validation</li>

</ul>

</section>
</section>
<section>
<section id="slide-org9477da1">
<h2 id="org9477da1">generalizing to subjects and stimuli</h2>
<div class="outline-text-2" id="text-org9477da1">
</div>
</section>
<section id="slide-org90c5453">
<h4 id="org90c5453">Language-as-fixed-effect fallacy</h4>
<ul>
<li>Psycholinguistic experiments sample language materials as well as subjects</li>
<li>Language stimuli should be treated as a random, not fixed factor</li>
<li>Clark's suggestion: \(F'\), min-\(F'\)</li>
<li>Modern solution: Linear-mixed effects with crossed random factors of subjects and stimuli</li>

</ul>

<div class="citation" id="org46e42bb">
<p>
Baayen, R. H., Davidson, D. J., &amp; Bates, D. M. (2008). <a href="https://doi.org/10.1016/j.jml.2007.12.005">Mixed-effects modeling with crossed random effects for subjects and items.</a> <i>Journal of Memory and Language</i>, <i>59</i>, 390-412.
</p>

<p>
Clark, H. H. (1973). <a href="https://doi.org/10.1016/S0022-5371(73)80014-3">The language-as-fixed-effect fallacy: A critique of language statistics in psychological research</a>. <i>Journal of Verbal Learning and Verbal Behavior</i>, <i>12</i>, 335-359.
</p>

</div>

</section>
<section id="slide-org5a93ed4">
<h4 id="org5a93ed4">Crossed random factors</h4>
<div class="column" style="float:left; width: 20%">

<div class="tab1">

</div></div>

<div class="column" style="float:left; width: 30%">

<div class="tab2">

</div></div>

<div class="column" style="float:right; width: 50%">

<div class="tab3">

<div class="org-src-container">

<pre  class="src src-R"   ><code trim>inner_join(subj, lists, "list_id")
</code></pre>
</div>

<pre class="example" id="org64aeac8">
   subj_id list_id stim_id condition
1        1       1       A treatment
2        1       1       B treatment
3        1       1       C   control
4        1       1       D   control
5        2       2       A   control
6        2       2       B   control
7        2       2       C treatment
8        2       2       D treatment
9        3       1       A treatment
10       3       1       B treatment
11       3       1       C   control
12       3       1       D   control
13       4       2       A   control
14       4       2       B   control
15       4       2       C treatment
16       4       2       D treatment
</pre>

</div></div>

</section>
<section id="slide-org1943673">
<h4 id="org1943673">generalizing over encounters</h4>
<p>
The target of inference in much of psychology and related fields has
been misidentified as a population of <i>subjects</i> or <i>stimuli</i>, when the
actual target of inference is a population of events: <b>encounters</b>
</p>

<div class="smaller" id="org317f620">
<ul>
<li>readers encountering particular types of words</li>
<li>male participants judging attractiveness of female faces, or vice versa</li>
<li>gamers encountering particular types of violent games</li>
<li>audience members encountering particular types of dance movements</li>
<li>insomniacs (versus controls) encountering emotional expressions</li>
<li>birds hearing particular types of birdsongs</li>

</ul>

</div>

<div class="citation" id="org55b0909">
<p>
Barr, D. J. (2018). Generalizing Over Encounters. In the <i>Oxford Handbook of Psycholinguistics.</i>
</p>

</div>


</section>
</section>
<section>
<section id="slide-orgc6c600b">
<h2 id="orgc6c600b">specifying random effects</h2>
<div class="outline-text-2" id="text-orgc6c600b">
</div>
</section>
<section id="slide-org6958e93">
<h4 id="org6958e93">general procedure for factorial designs</h4>
<p>
for each random factor (subjects/stimuli):
</p>

<ol>
<li>identify within-unit factors</li>
<li>check highest-order combination of within-subject factors
<ul>
<li><i>NO pseudoreplications:</i> no random slopes</li>
<li><i>YES pseudoreplications:</i> all interactions/main effects get slopes</li>

</ul></li>

</ol>

<p>
<i>between-unit factors (or interactions involving them) never get random slopes</i>
</p>

<div class="citation" id="org9e486f2">
<p>
Barr, D. J. (2013). <a href="https://doi.org/10.3389/fpsyg.2013.00328">Random effects structure for testing interactions in linear mixed-effects models</a>. <i>Frontiers in Psychology</i>, <i>4</i>, 328.
</p>

<p>
Barr, D. J., Levy, R., Scheepers, C., &amp; Tily, H. J. (2013). <a href="https://doi.org/10.1016/j.jml.2012.11.001">Random effects structure for confirmatory hypothesis testing: Keep it maximal</a>. <i>Journal of Memory and Language</i>, <i>68</i>, 255-278.
</p>

</div>

</section>
<section id="slide-org04693a3">
<h4 id="org04693a3">determining the design from data</h4>
<p>
three way design, subjects only random factor
</p>

<div class="column" style="float:left; width: 50%">

<div class="tab1">

<pre class="example" id="org6a8a2f6">
# A tibble: 128 x 5
   subj_id A     B     C          DV
     &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;
 1       5 A1    B1    C2     4.80  
 2       5 A1    B2    C1     7.40  
 3       1 A2    B1    C2     0.444 
 4       6 A2    B1    C2     3.97  
 5       4 A1    B1    C2     2.90  
 6       4 A1    B2    C1    -0.0699
 7       3 A1    B2    C2     2.75  
 8       1 A2    B2    C2     2.86  
 9       3 A1    B2    C2     0.452 
10       8 A1    B1    C1    -0.694 
# … with 118 more rows
</pre>

</div></div>

<div class="column" style="float:left; width: 50%">

<div class="tab2">

<div class="org-src-container">

<pre  class="src src-R"   ><code trim>count(dat1, subj_id, A, B, C)
</code></pre>
</div>

<pre class="example" id="org1dee23d">
# A tibble: 32 x 5
   subj_id A     B     C         n
     &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt;
 1       1 A2    B1    C1        4
 2       1 A2    B1    C2        4
 3       1 A2    B2    C1        4
 4       1 A2    B2    C2        4
 5       2 A2    B1    C1        4
 6       2 A2    B1    C2        4
 7       2 A2    B2    C1        4
 8       2 A2    B2    C2        4
 9       3 A1    B1    C1        4
10       3 A1    B1    C2        4
# … with 22 more rows
</pre>

</div></div>

<p>
\(A\) is between, \(BC\) within, 4 obs / cell
</p>

<p>
<code>DV ~ A * B * C + (B * C | subj_id)</code>
</p>

</section>
<section id="slide-org2ffe407">
<h4 id="org2ffe407">example with crossed random factors</h4>
<p>
<code>DV ~ A * B * C + (? | subj_id) + (? | item_id)</code>
</p>

<div class="tab1">

<div class="org-src-container">

<pre  class="src src-R"   ><code trim>dat2
</code></pre>
</div>

<pre class="example" id="orga46788b">
# A tibble: 128 x 6
   subj_id item_id A     B     C         DV
     &lt;int&gt;   &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;
 1       7      13 A1    B2    C2     1.41 
 2       3       6 A1    B1    C2     3.62 
 3       3       1 A2    B2    C2     2.79 
 4       2       4 A1    B2    C1    -1.41 
 5       4      10 A2    B1    C1     0.971
 6       7       5 A2    B2    C2     8.12 
 7       7      16 A2    B1    C1     7.66 
 8       6       3 A2    B1    C1     3.00 
 9       7      10 A1    B1    C2     0.644
10       6       9 A2    B2    C2    10.7  
# … with 118 more rows
</pre>

</div>

</section>
<section id="slide-org84b043b">
<h4 id="org84b043b">by-subject random effects</h4>
<div class="tab1">

<div class="org-src-container">

<pre  class="src src-R"   ><code trim>dat2 %&gt;%
  count(subj_id, A, B, C)
</code></pre>
</div>

<pre class="example" id="org35ad807">
# A tibble: 64 x 5
   subj_id A     B     C         n
     &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt;
 1       1 A1    B1    C1        2
 2       1 A1    B1    C2        2
 3       1 A1    B2    C1        2
 4       1 A1    B2    C2        2
 5       1 A2    B1    C1        2
 6       1 A2    B1    C2        2
 7       1 A2    B2    C1        2
 8       1 A2    B2    C2        2
 9       2 A1    B1    C1        2
10       2 A1    B1    C2        2
# … with 54 more rows
</pre>

</div>

<div class="org-src-container">

<pre  class="src src-R"   ><code trim>DV ~ A * B * C + (A * B * C | subj_id) + (? | item_id)
</code></pre>
</div>

</section>
<section id="slide-orgb83d739">
<h4 id="orgb83d739">by-stimulus random effects</h4>
<div class="tab2">

<div class="org-src-container">

<pre  class="src src-R"   ><code trim>dat2 %&gt;%
  count(item_id, A, B, C)
</code></pre>
</div>

<pre class="example" id="org46be382">

# A tibble: 128 x 5
   item_id A     B     C         n
     &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt;
 1       1 A1    B1    C1        1
 2       1 A1    B1    C2        1
 3       1 A1    B2    C1        1
 4       1 A1    B2    C2        1
 5       1 A2    B1    C1        1
 6       1 A2    B1    C2        1
 7       1 A2    B2    C1        1
 8       1 A2    B2    C2        1
 9       2 A1    B1    C1        1
10       2 A1    B1    C2        1
# … with 118 more rows
</pre>

</div>

<div class="org-src-container">

<pre  class="src src-R"   ><code trim>DV ~ A * B * C + (A * B * C | subj_id) + (1 | item_id)
</code></pre>
</div>

</section>
</section>
<section>
<section id="slide-org1893ca5">
<h2 id="org1893ca5">non-convergence and model validation</h2>
<div class="outline-text-2" id="text-org1893ca5">
</div>
</section>
</section>
<section>
<section id="slide-orgc2fe43a">
<h3 id="orgc2fe43a">non-convergence</h3>
<p>
When you get a convergence warning you should in the first instance:
</p>

<ul>
<li>double-check the model specification</li>
<li>make sure all predictors are scaled and centred</li>

</ul>

<p>
then re-fit the model. If it still does not converge, seek to reduce
the random effects structure, but <b><b>proceed with caution.</b></b>
</p>

<p>
You can also try different optimizers (see <code>?lme4::convergence</code>)
</p>

<p>
<i><code>"model is singular"</code> is NOT a convergence warning</i>
</p>

</section>
<section id="slide-orgfa0e8b5">
<h4 id="orgfa0e8b5">reducing random effects structure</h4>
<p>
Reducing random effects can help convergence, but the worst thing you
can do is remove the slope for a theory-critical predictor.
</p>

<ol>
<li>Remove random correlations and re-fit
<ul>
<li>Use <code>(A * B || subject)</code></li>

</ul></li>

<li>Worst case scenario: effectwise testing, e.g.:
<ul>
<li>test A using (A | subject) + (A | stimulus)</li>
<li>test B using (B | subject) + (B | stimulus)</li>
<li>test AB using (A:B | subject) + (A:B | stimulus)</li>

</ul></li>

</ol>

</section>
</section>
<section>
<section id="slide-org6b334df">
<h3 id="org6b334df">checking assumptions</h3>
<ul>
<li>linearity</li>
<li>homogeneity of variance</li>
<li>normality of residuals
<ul>
<li>outliers</li>
<li>multimodality</li>
<li>other weirdness (skew, etc)</li>

</ul></li>

</ul>

</section>
<section id="slide-orga8ceeaf">
<h4 id="orga8ceeaf">linearity</h4>
<ul>
<li>fitted (line) v. observed (points)</li>

</ul>

<div class="column" style="float:left; width: 50%">
<div class="org-src-container">

<pre  class="src src-R"   ><code trim>mod &lt;- lmer(Reaction ~ Days + 
	      (Days | Subject),
	    sleepstudy, REML = FALSE)

## fitted values: 
##   fitted(mod)
## residuals:
##   residuals(mod)
</code></pre>
</div>
</div>

<div class="column" style="float:right; width: 50%">

<div id="org495be4e" class="figure">
<p><img src="fits.png" alt="fits.png" />
</p>
</div>

</div>

</section>
<section id="slide-orgc1d240a">
<h4 id="orgc1d240a">homogeneity of variance</h4>
<div class="column" style="float:left; width: 50%">

<div class="org-src-container">

<pre  class="src src-R"   ><code trim>n_obs &lt;- 200L
dat3 &lt;- tibble(cond = rep(c("A", "B"), 
			  each = n_obs),
	       Y = c(rnorm(n_obs, 0, 100),
		     rnorm(n_obs, 0, 50)))

ggplot(dat3, aes(cond, Y)) +
  geom_violin() +
  geom_jitter(alpha = .2)
</code></pre>
</div>

<div id="orgbe31bec" class="figure">
<p><img src="nhomog_cat.png" alt="nhomog_cat.png" />
</p>
</div>

</div>

<div class="column" style="float:right; width: 50%">

<div class="org-src-container">

<pre  class="src src-R"   ><code trim>n_pts &lt;- 10L
n_obs &lt;- 50
dat4 &lt;- tibble(
  x = seq_len(n_pts),
  y = map(x, # purrr::map()
	  ~ rnorm(n_obs, 5 * .x, 10 * .x))) %&gt;%
  unnest() # tidyr::unnest()

ggplot(dat4, aes(x, y)) +
  geom_point(alpha = .2) +
  geom_smooth(method = "lm")
</code></pre>
</div>

</div>

</section>
<section id="slide-org2f7a046">
<h4 id="org2f7a046">normality of residuals</h4>
<ul>
<li>don't visualize the raw DV to check for normality!</li>

</ul>

<p>
<a href="https://dalejbarr.shinyapps.io/raw_vs_resids/">https://dalejbarr.shinyapps.io/raw_vs_resids/</a>
</p>

</section>
<section id="slide-org0ccdadc">
<h4 id="org0ccdadc">visual checks</h4>
<div class="column" style="float:left; width: 50%">
<ul>
<li>histogram</li>

</ul>

<div class="org-src-container">

<pre  class="src src-R"   ><code trim>## resids from the model fit to sleepstudy
my_resids &lt;- residuals(mod)

## it is a vector, must put into a tibble
## for ggplot
rtbl &lt;- tibble(residual = my_resids)

ggplot(rtbl, aes(residual)) +
  geom_histogram()
</code></pre>
</div>


<div id="org758476f" class="figure">
<p><img src="histo.png" alt="histo.png" />
</p>
</div>

</div>

<div class="column" style="float:right; width: 50%">
<ul>
<li>Q-Q plot (quantile-quantile)</li>

</ul>

<div class="org-src-container">

<pre  class="src src-R"   ><code trim>## sadly there is no qqplot for ggplot
## so we use base::qqnorm()
qqnorm(my_resids)
</code></pre>
</div>


<div id="org6cd1521" class="figure">
<p><img src="qqplot.png" alt="qqplot.png" />
</p>
</div>

</div>

<div class="citation" id="org55758ff">
<p>
Vanhove, J. (2018). <i>Checking the assumptions of your statistical model without getting paranoid.</i> Preprint at <a href="https://psyarxiv.com/zvawb/">https://psyarxiv.com/zvawb/</a>.
</p>

</div>
</section>
</section>
</div>
</div>
<p> Created by Dale Barr </p>
<script src="./reveal.js/dist/reveal.js"></script>
<script src="./reveal.js/plugin/markdown/markdown.js"></script>
<script src="./reveal.js/plugin/notes/notes.js"></script>


<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({
plugins: [RevealMarkdown, RevealNotes],
width:1200, height:800, margin: 0.1, minScale:0.2, maxScale:2.5, transition:'fade'
});

</script>
</body>
</html>
